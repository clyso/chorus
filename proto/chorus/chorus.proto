syntax = "proto3";

package chorus;

import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/clyso/chorus/proto/chorus;pb";

service Chorus {
  // Get app version
  rpc GetAppVersion(google.protobuf.Empty) returns (GetAppVersionResponse);
  // Lists configured storages with users
  rpc GetStorages(google.protobuf.Empty) returns (GetStoragesResponse);
  // Returns connection details for proxy s3 endpoint
  rpc GetProxyCredentials(google.protobuf.Empty)
      returns (GetProxyCredentialsResponse);
  // Returns list of registered chorus agents.
  rpc GetAgents(google.protobuf.Empty) returns (GetAgentsResponse);
}

message GetAppVersionResponse {
  string version = 1;
  string commit = 2;
  string date = 3;
}

message GetStoragesResponse { repeated Storage storages = 1; }

message Storage {
  enum Type {
    S3 = 0;
    SWIFT = 1;
  }
  // some human-readable alias for storage config
  string name = 1;
  bool is_main = 2;
  // ex: s3.clyso.com
  string address = 3;
  Type provider = 4;
  // credentials: access key (public, aka username)
  repeated Credential credentials = 5;
}

message Credential {
  string alias = 1;
  string access_key = 2;
  string secret_key = 3;
}

message GetProxyCredentialsResponse {
  string address = 1;
  repeated Credential credentials = 2;
}

// List of registered chorus agents.
message GetAgentsResponse { repeated Agent agents = 1; }

message Agent {
  // Storage name from chorus storage config associated with this agent.
  string storage = 1;
  // Webhook URL of chorus agent to be used for agent-based replication.
  string url = 2;
}
