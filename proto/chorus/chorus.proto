syntax = "proto3";

package chorus;

import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/clyso/chorus/proto/chorus;pb";

service Chorus {
  // Get app version
  rpc GetAppVersion(google.protobuf.Empty) returns (GetAppVersionResponse);
  // Lists configured storages with users
  rpc GetStorages(google.protobuf.Empty) returns (GetStoragesResponse);
  // Returns connection details for proxy s3 endpoint
  rpc GetProxyCredentials(google.protobuf.Empty)
      returns (GetProxyCredentialsResponse);
  // Sets user credentials for a given storage.
  rpc SetUserCredentials(SetUserCredentialsRequest)
      returns (google.protobuf.Empty);
}

message GetAppVersionResponse {
  string version = 1;
  string commit = 2;
  string date = 3;
}

message GetStoragesResponse { repeated Storage storages = 1; }

message Storage {
  enum Type {
    S3 = 0;
    SWIFT = 1;
  }
  // some human-readable alias for storage config
  string name = 1;
  bool is_main = 2;
  // ex: s3.clyso.com
  string address = 3;
  Type provider = 4;
  // credentials: access key (public, aka username)
  repeated Credential credentials = 5;
}

message Credential {
  string alias = 1;
  string access_key = 2;
  string secret_key = 3;
}

message GetProxyCredentialsResponse {
  string address = 1;
  repeated Credential credentials = 2;
}

message SetUserCredentialsRequest {
  string storage = 1;
  string user = 2;
  optional S3Credential s3_cred = 3;
  optional SwiftCredential swift_cred = 4;
}

message S3Credential {
  string access_key = 1;
  string secret_key = 2;
}

message SwiftCredential {
  string username = 1;
  string password = 2;
  string domain_name = 3;
  string tenant_name = 4;
}
